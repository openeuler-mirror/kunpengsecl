# 国密算法（SM2/SM3/SM4）使用指南

## 1. 算法简介与应用场景

### SM2（椭圆曲线公钥密码算法）

- **类型**：非对称加密/签名
- **用途**：
  - 数字签名（替代RSA/ECDSA）
  - 密钥交换
  - 加密小数据（如会话密钥）
- **特点**：
  256位密钥强度，基于椭圆曲线密码学，符合GM/T 0003-2012标准

### SM3（密码杂凑算法）

- **类型**：哈希算法
- **用途**：
  - 数据完整性校验
  - 数字签名中的消息摘要
  - 替代SHA-256
- **特点**：
  输出固定256位，抗碰撞性强，符合GM/T 0004-2012标准

### SM4（分组密码算法）

- **类型**：对称加密
- **用途**：
  - 数据加密（如文件/数据库字段）
  - 安全通信协议（如TLS）
- **特点**：
  128位分组长度，128位密钥，支持CBC/ECB模式，符合GM/T 0002-2012标准

### 环境准备

```bash
# 启用SM4内核模块（需root权限）
sudo modprobe sm4-generic
sudo modprobe sm4-avx

# 验证算法是否启用
cat /proc/crypto | grep sm4 -A8
```

### SM2 密钥生成与签名

```
// 生成密钥对（PEM格式）
pubKey, privKey, err := sm2.GenerateKeyPair()
if err != nil {
    panic(err)
}

// 签名
data := []byte("critical data")
sig, err := sm2.Sign(privKey, data)
if err != nil {
    panic(err)
}

// 验签
valid, err := sm2.Verify(pubKey, data, sig)
```

### SM3 哈希计算

```
hash, err := sm3.Hash([]byte("message"))
// 输出：66c7f0f462eeedd9d1f2d46bdc10e4e24167c4875cf2f7a2297da02b8f4ba8e0
```

### SM4 加密/解密

```
key := []byte("0123456789abcdef") // 16字节
plaintext := []byte("sensitive data")

// 加密（自动生成IV）
ciphertext, iv, err := sm4.Encrypt(plaintext, key)

// 解密
decrypted, err := sm4.Decrypt(ciphertext, key, iv)
```
